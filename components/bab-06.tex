\chapter{Mengakses Basis Data NoSQL: mongoDB}

\section{Apa itu Basis Data NoSQL?}

Pada awalnya, istilah NoSQL digunakan oleh Carlo Strozzi untuk menyebut nama software basis data yang dibuat olehnya. Software basis data tersebut tidak mengikuti standar SQL, sehingga dia menyebut software tersebut dengan "NoSQL"\footnote{\url{http://www.strozzi.it/cgi-bin/CSA/tw7/I/en_US/nosql/Home\%20Page}}. Setelah itu, istilah NoSQL dipopulerkan oleh Eric Evans untuk menyebut jenis software basis data yang tidak menggunakan standar SQL. Dalam perkembangan berikutnya, NoSQL ini lebih diarahkan pada "Not Only SQL" dan digunakan untuk kategorisasi basis data \textit{non-relational} (misalnya OODBMS, Graph Database, Document-oriented, dan lain-lain). Meski ada usaha untuk menstandarkan bahasa \textit{query} untuk NoSQL (UnQL - \textit{Unstructured Query Language}), sampai saat ini usaha tersebut tidak menghasilkan sesuatu hal yang disepakati bersama karena dunia NoSQL memang kompleks sekali. Untuk melihat daftar dari basis data NoSQL, anda bisa melihat ke \url{http://nosql-databases.org}.

\section{Mengenal mongoDB dan Fitur-fiturnya}

mongoDB adalah salah satu software NoSQL yang termasuk dalam kategori \textit{Document Store} / \textit{Document-Oriented Database}, yaitu data disimpan dalam bentuk dokumen. Suatu dokumen bisa diibaratkan seperti suatu \textit{record} dalam basis data relasional dan isi dari masing-masing dokumen tersebut bisa berbeda-beda dan ada pula yang sama. Hal ini berbeda dengan basis data relasional yang menetapkan keseragaman kolom serta tipe data dengan data yang NULL jika tidak terdapat data. mongoDB menyimpan data dalam bentuk dokumen dengan menggunakan format JSON. Berikut adalah fitur dari mongoDB:
\begin{itemize}
	\item menggunakan format JSON dalam penyimpanan data
	\item mendukung indeks
	\item mendukung replikasi
	\item auto-sharding untuk skalabilitas horizontal
	\item query yang lengkap
	\item pembaruan data yang cepat
	\item mendukung Map/Reduce
	\item mendukung GridFS
\end{itemize}

\subsection{Memulai Server}
Seperti halnya basis data relasional seperti MySQL, PostgreSQL, dan lain-lain, mongoDB juga memulai dengan menjalankan server yang memungkinkan server tersebut melayani permintaan akses data dokumen melalui klien. Untuk memulai server, siapkan direktori yang akan menjadi tempat menyimpan data (defaultnya adalah /data/db). Jika menginginkan lokasi lain, gunakan argumen \textit{--dbpath} saat menjalankan server sebagai berikut (buat direktorinya jika belum ada):

\lstset{language=bash,caption=Menjalankan server MongoDB (mongod)}
\begin{lstlisting}
$ pwd
/home/bpdp/mongodb
$ mkdir data
$ mongod --rest --dbpath ./data
Tue Dec 11 14:40:20 
Tue Dec 11 14:40:20 warning: 32-bit servers don't have journaling 
enabled by default. Please use --journal if you want durability.
Tue Dec 11 14:40:20 
Tue Dec 11 14:40:20 [initandlisten] MongoDB starting : pid=24381 
port=27017 dbpath=./data 32-bit host=bpdp-arch
Tue Dec 11 14:40:20 [initandlisten] 
Tue Dec 11 14:40:20 [initandlisten] ** NOTE: when using MongoDB 
32 bit, you are limited to about 2 gigabytes of data
Tue Dec 11 14:40:20 [initandlisten] **       see 
http://blog.mongodb.org/post/137788967/32-bit-limitations
Tue Dec 11 14:40:20 [initandlisten] **       with --journal, the 
limit is lower
Tue Dec 11 14:40:20 [initandlisten] 
Tue Dec 11 14:40:20 [initandlisten] db version v2.2.2, pdfile 
version 4.5
Tue Dec 11 14:40:20 [initandlisten] git version: nogitversion
Tue Dec 11 14:40:20 [initandlisten] build info: Linux felix 
3.6.7-1-ARCH #1 SMP PREEMPT Sun Nov 18 10:11:22 CET 2012 i686 
BOOST_LIB_VERSION=1_50
Tue Dec 11 14:40:20 [initandlisten] options: { dbpath: "./data", rest: true}
Tue Dec 11 14:40:20 [initandlisten] Unable to check for journal 
files due to: boost::filesystem::directory_iterator::construct: 
No such file or directory: "./data/journal"
Tue Dec 11 14:40:21 [websvr] admin web console waiting for 
connections on port 28017
Tue Dec 11 14:40:21 [initandlisten] waiting for connections on 
port 27017
\end{lstlisting}

Setelah server hidup, pemrogram bisa menggunakan antarmuka administrasi web maupun menggunakan shell. \textit{Admin web console} bisa diakses menggunakan port 28017 seperti pada gambar~\ref{fig:mongowebadminconsole}. Sementara itu, untuk mengakses server menggunakan shell, bisa digunakan perintah \textit{mongo} sebagai berikut:

\lstset{language=bash,caption=Shell mongoDB (mongo)}
\begin{lstlisting}
$ mongo
MongoDB shell version: 2.2.2
connecting to: test
> 
\end{lstlisting}

  \begin{figure}
    \begin{center}
      \includegraphics[scale=0.5]{images/mongodb-web-interface.jpg}
    \end{center}
    \caption{Admin web console untuk mongoDB}
    \label{fig:mongowebadminconsole}
  \end{figure}

Untuk mengakhiri server, tekan \textit{Ctrl-C}, mongoDB akan mengakhiri server sebagai berikut:

\lstset{language=bash,caption=Mengakhiri server MongoDB (mongod)}
\begin{lstlisting}
^CTue Dec 11 15:16:38 got signal 2 (Interrupt), will terminate after current cmd ends
Tue Dec 11 15:16:38 [interruptThread] now exiting
Tue Dec 11 15:16:38 dbexit: 
Tue Dec 11 15:16:38 [interruptThread] shutdown: going to close listening sockets...
Tue Dec 11 15:16:38 [interruptThread] closing listening socket: 5
Tue Dec 11 15:16:38 [interruptThread] closing listening socket: 6
Tue Dec 11 15:16:38 [interruptThread] closing listening socket: 7
Tue Dec 11 15:16:38 [interruptThread] removing socket file: /tmp/mongodb-27017.sock
Tue Dec 11 15:16:38 [interruptThread] shutdown: going to flush diaglog...
Tue Dec 11 15:16:38 [interruptThread] shutdown: going to close sockets...
Tue Dec 11 15:16:38 [interruptThread] shutdown: waiting for fs preallocator...
Tue Dec 11 15:16:38 [interruptThread] shutdown: closing all files...
Tue Dec 11 15:16:38 [interruptThread] closeAllFiles() finished
Tue Dec 11 15:16:38 [interruptThread] shutdown: removing fs lock...
Tue Dec 11 15:16:38 dbexit: really exiting now
\end{lstlisting}

\section{Node.js dan MongoDB}

\subsection{Node-gyp}

Node-gyp merupakan \textit{native add-on build tool}, berfungsi untuk membantu proses kompilasi modul add-on native di Node.js. Node-gyp merupakan software bebas dan bisa diinstall menggunakan npm:

\lstset{language=bash,caption=Instalasi node-gyp}
\begin{lstlisting}
$ npm install -g node-gyp
npm http GET https://registry.npmjs.org/node-gyp
npm http 200 https://registry.npmjs.org/node-gyp
npm http GET https://registry.npmjs.org/glob
npm http GET https://registry.npmjs.org/mkdirp
npm http GET https://registry.npmjs.org/fstream
npm http GET https://registry.npmjs.org/minimatch
npm http GET https://registry.npmjs.org/graceful-fs
npm http GET https://registry.npmjs.org/request
npm http GET https://registry.npmjs.org/tar
npm http GET https://registry.npmjs.org/semver
npm http GET https://registry.npmjs.org/rimraf
npm http GET https://registry.npmjs.org/which
npm http GET https://registry.npmjs.org/osenv
npm http GET https://registry.npmjs.org/npmlog
npm http GET https://registry.npmjs.org/nopt
npm http 304 https://registry.npmjs.org/glob
npm http 304 https://registry.npmjs.org/minimatch
npm http 304 https://registry.npmjs.org/mkdirp
npm http 304 https://registry.npmjs.org/request
npm http 304 https://registry.npmjs.org/graceful-fs
npm http 304 https://registry.npmjs.org/semver
npm http GET https://registry.npmjs.org/semver/-/semver-1.1.1.tgz
npm http 200 https://registry.npmjs.org/fstream
npm http 200 https://registry.npmjs.org/tar
npm http GET https://registry.npmjs.org/tar/-/tar-0.1.14.tgz
npm http 200 https://registry.npmjs.org/rimraf
npm http 200 https://registry.npmjs.org/which
npm http 304 https://registry.npmjs.org/nopt
npm http 200 https://registry.npmjs.org/osenv
npm http 200 https://registry.npmjs.org/npmlog
npm http 200 https://registry.npmjs.org/semver/-/semver-1.1.1.tgz
npm http 200 https://registry.npmjs.org/tar/-/tar-0.1.14.tgz
npm http GET https://registry.npmjs.org/abbrev
npm http GET https://registry.npmjs.org/sigmund
npm http GET https://registry.npmjs.org/lru-cache
npm http GET https://registry.npmjs.org/ansi
npm http GET https://registry.npmjs.org/inherits
npm http GET https://registry.npmjs.org/inherits
npm http GET https://registry.npmjs.org/inherits
npm http GET https://registry.npmjs.org/block-stream
npm http 304 https://registry.npmjs.org/sigmund
npm http 304 https://registry.npmjs.org/abbrev
npm http 304 https://registry.npmjs.org/lru-cache
npm http 304 https://registry.npmjs.org/inherits
npm http 304 https://registry.npmjs.org/inherits
npm http 304 https://registry.npmjs.org/inherits
npm http 200 https://registry.npmjs.org/ansi
npm http 200 https://registry.npmjs.org/block-stream
/home/bpdp/software/nodejs/bin/node-gyp -> /home/bpdp/software/nodejs/lib/node_modules/node-gyp/bin/node-gyp.js
node-gyp@0.8.1 /home/bpdp/software/nodejs/lib/node_modules/node-gyp
+-- graceful-fs@1.1.14
|-- osenv@0.0.3
|-- rimraf@2.0.2
|-- mkdirp@0.3.4
|-- which@1.0.5
|-- semver@1.1.1
|-- request@2.9.203
|-- nopt@2.0.0 (abbrev@1.0.3)
|-- minimatch@0.2.9 (sigmund@1.0.0, lru-cache@2.0.4)
|-- glob@3.1.14 (inherits@1.0.0)
|-- fstream@0.1.19 (inherits@1.0.0)
|-- npmlog@0.0.2 (ansi@0.1.2)
+-- tar@0.1.14 (inherits@1.0.0, block-stream@0.0.6)
\end{lstlisting}

Node-gyp ini diinstall pada lokasi global. Pada materi ini, Node-gyp diperlukan untuk membangun \textit{driver} dari mongoDB sehingga mongoDB bisa diakses oleh Node.js. 

\subsection{Driver Node.js untuk mongoDB}

Mengakses mongoDB dari Node.js bisa dilakukan dengan menggunakan driver atau berbagai \textit{wrapper} serta solusi sejenis ORM \textit{Object-Relational Mapping}. Beberapa solusi yang tersedia adalah:
\lstset{language=bash,caption=Instalasi driver mongoDB}
\begin{lstlisting}
$ npm install mongodb
npm WARN package.json kintamani@0.1.0 No README.md file found!
npm http GET https://registry.npmjs.org/mongodb
npm http 304 https://registry.npmjs.org/mongodb
npm http GET https://registry.npmjs.org/bson/0.1.5
npm http 304 https://registry.npmjs.org/bson/0.1.5

> bson@0.1.5 install /home/bpdp/node_modules/mongodb/node_modules/bson
> node install.js || (exit 0)

================================================================================
=                                                                              =
=  Attempting to build bson c++ extension                                      =
=   Windows: no build will be attempted as binaries are prepackaged            =
=   Unix: on failure the package will still install without the C++ extension  =
=                                                                              =
================================================================================
node-gyp clean
node-gyp configure build
gyp http GET http://nodejs.org/dist/v0.8.15/node-v0.8.15.tar.gz
gyp http 200 http://nodejs.org/dist/v0.8.15/node-v0.8.15.tar.gz
make[1]: Entering directory `/home/bpdp/node_modules/mongodb/node_modules/bson/build'
  CXX(target) Release/obj.target/bson/ext/bson.o
  SOLINK_MODULE(target) Release/obj.target/bson.node
  SOLINK_MODULE(target) Release/obj.target/bson.node: Finished
  COPY Release/bson.node
make[1]: Leaving directory `/home/bpdp/node_modules/mongodb/node_modules/bson/build'
child process exited with code 0
mongodb@1.2.3 ../../../../../node_modules/mongodb
+-- bson@0.1.5
\end{lstlisting}


\section{Aplikasi Web Menggunakan Node.js dan MongoDB}

